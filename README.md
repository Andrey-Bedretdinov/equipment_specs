---
# Техническое задание (ТЗ)

---

## 1. Введение

Цель проекта — разработать веб-приложение «Программа составления спецификаций оборудования» с мультипользовательским
доступом, надёжной авторизацией и высокодоступным хранением сессий.

**Основные технологии:**

- **Ядро:** Django
- **База данных:** PostgreSQL
- **Кэш и сессии:** Redis
- **Авторизация:** JWT + django-allauth
- **Среда выполнения:** Docker

---

## 2. Общая архитектура

- Nginx + Gunicorn — обратный прокси и WSGI-сервер
- Django — бизнес-логика, REST API, шаблоны
- PostgreSQL — транзакции, ACID
- Redis — распределённые сессии, throttle

---

## 3. Нефункциональные требования

| Параметр           | Показатель                                                     | Комментарий                                                          |
|--------------------|----------------------------------------------------------------|----------------------------------------------------------------------|
| Производительность | < 200 мс ответа API под нагрузкой 100 пользователей            | Возможно, потребуется кэширование часто запрашиваемых данных в Redis |
| Масштабируемость   | Горизонтальное масштабирование через Docker Swarm / Kubernetes |                                                                      |
| Безопасность       | HTTPS, CSP, HttpOnly-cookie для JWT                            | Django-средства для защиты от CSRF/XSS/SQL-инъекций                  |
| Доступность        | SLA ≥ 99.5%                                                    | Горизонтальное дублирование PostgreSQL, Redis                        |
| Логи и мониторинг  | ELK Stack / Grafana + Prometheus                               |                                                                      |

---

## 4. Функциональные требования

### 4.1. Авторизация и безопасность

1. Регистрация и аутентификация

- Вход по электронной почте + пароль
- Подтверждение почты через одноразовый токен
- Сброс пароля по email

2. JWT-токены

- Access токен (короткий срок жизни)
- Refresh токен (долгий срок жизни, хранится в Redis)

3. Роли и права доступа

- ГИП (главный инженер проекта)
- Специалист
- Администратор

4. Защита

- Ограничение числа попыток входа (throttle через Redis)
- Хранение всех секретов в переменных окружения / Vault

### 4.2. Управление спецификациями

| № | Функция                                             | Описание                                                                           |
|---|-----------------------------------------------------|------------------------------------------------------------------------------------|
| 1 | Создание новой пустой спецификации                  | ГИП создаёт проект, указывает название, описание                                   |
| 2 | Просмотр и редактирование существующих спецификаций | Фильтрация по проекту, роли, дате                                                  |
| 3 | Режим «только моё»                                  | Пользователь видит и редактирует только свои позиции (или группы)                  |
| 4 | Группировка по комплексам технических средств       | Древовидная структура: комплекс → комплектная единица → изделия                    |
| 5 | Параллельное заполнение несколькими специалистами   | Блокировки на уровне записи, optimistic locking                                    |
| 6 | Закрепление области просмотра за специалистом       | Каждый специалист «видит» только свой набор позиций (отдельный фильтр)             |
| 7 | Добавление единиц и изделий в спецификацию          | Указание поставщика, артикул, наименование, количество, цена, валюта, вид поставки |
| 8 | Копирование изделий и групп изделий                 | Быстрое дублирование для различных проектов                                        |

### 4.3. Расчёты и отчёты

- Суммарная стоимость
- По каждой комплектной единице
- По технологическому участку
- Общая по проекту
- Печать закупочной ведомости
- Группировка по производителю/поставщику
- Объединение однотипных изделий
- Версионирование
- Хранение вариантов спецификации
- Откат к любой сохранённой версии

---

## 5. Сценарии использования (Use Cases)

| ID  | Название                       | Роль               | Цель                                  | Описание                                                                                           |
|-----|--------------------------------|--------------------|---------------------------------------|----------------------------------------------------------------------------------------------------|
| UC1 | NewProjectSpecification        | ГИП, ведущий спец. | Создать новую спецификацию            | ГИП создаёт пустой проект → определяет комплексы → добавляет комплектные единицы                   |
| UC2 | AddItem                        | Ведущий специалист | Добавить новую позицию                | Открыть нужную спецификацию → выбрать комплекс → добавить изделие → указать все параметры          |
| UC3 | EditItem                       | Ведущий специалист | Изменить существующую позицию         | Открыть спецификацию → найти изделие → отредактировать данные (цена, количество и т.д.)            |
| UC4 | ViewFinalSpecification (Print) | ГИП, ведущий спец. | Просмотреть и напечатать спецификацию | Открыть спецификацию → сгенерировать PDF/Excel → вывести итоговые суммы и ведомость по поставщикам |

---

## 6. Нефункциональные требования и ограничения

- Бэкенд: Python 3.11
- Фронтенд: Bootstrap 5 / Vue.js (по желанию)
- Документация API: Swagger / Redoc

Ограничения:

- Не более 1 000 позиций в спецификации без пагинации
- Макс. 5 одновременных правок одного документа (остальные получают уведомление о блокировке)

